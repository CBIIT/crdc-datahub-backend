generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type OrgInfo {
  id        String    @map("_id")
  name      String
  // Optional fields to cover all organization use cases
  status    String?
  createdAt DateTime? @db.Date
  updateAt  DateTime? @db.Date
  orgID     String?
  orgName   String?
}

type Applicant {
  applicantEmail String
  applicantID    String
  applicantName  String
}

type BatchFiles {
  createdAt  DateTime @db.Date
  errors     String[]
  fileID     String?
  fileName   String
  filePrefix String
  nodeType   String?
  signedURL  String?
  size       Int?
  status     String
  updatedAt  DateTime @db.Date
}

type PBACDefaults {
  notifications Notification[]
  permissions   Permission[]
  role          String
}

type Notification {
  id       String  @map("_id")
  checked  Boolean
  disabled Boolean
  group    String
  name     String
  order    Int
}

type Permission {
  id        String   @map("_id")
  checked   Boolean
  disabled  Boolean
  group     String
  inherited String[]
  name      String
  order     Int
}

type ConfigurationTag {
  Key   String
  Value String
}

type AdditionalError {
  conflictingSubmissions String[]
  description            String
  title                  String
}

type S3FileInfo {
  createdAt DateTime? @db.Date
  errors    Error[]
  fileName  String
  md5       String?
  size      String?
  status    String
  updatedAt DateTime? @db.Date
  /// Could not determine type: the field only had null or empty values in the sample set.
  warnings  Error[]
}

type LogsEventDetail {
  nodeIDs      String[]
  nodeType     String
  submissionID String
}

type InstitutionInfo {
  id     String @map("_id")
  name   String
  status String
}

type Collaborator {
  collaboratorID   String
  collaboratorName String?
  /// Multiple data types found: String: 97.4%, Array(String): 2.6% out of 38 sampled entries
  permission       String
}

type CollaboratorOrg {
    id        String    @map("orgID")
    orgName      String?
}

type DataFileSize {
  formatted String
  size      Int
}

type StudyByID {
  id String @map("_id")
}

type Parent {
  parentIDPropName String
  parentIDValue    String
  parentType       String
}

type History {
  dateTime      DateTime @db.Date
  reviewComment String?
  status        String
  userID        String?
  userName      String?
}

type Error {
  title             String
  description       String
  // Optional fields from QcResultsErrors that can be used across all error types
  code              String?
  offendingProperty String?
  offendingValue    String?
  severity          String?
}

type newInstitution {
    id String @map("_id")
    name String
}

model CDE {
  id                String   @id @default(uuid()) @map("_id")
  CDECode           String
  CDEFullName       String
  CDEVersion        String?
  PermissibleValues String[]
  createdAt         DateTime @default(now()) @db.Date
  updatedAt         DateTime @updatedAt @db.Date

  @@index([CDECode, CDEVersion], map: "CDECode_1_CDEVersion_1")
}

model Application {
  id                  String    @id @default(uuid()) @map("_id")
  version             String
  ORCID               String?
  PI                  String?
  controlledAccess    Boolean?
  history             History[]
  openAccess          Boolean?
  organization        OrgInfo?
  programAbbreviation String?
  programDescription  String?
  programName         String
  questionnaireData   String
  reviewComment       String?
  status              String
  studyAbbreviation   String
  studyName           String
  /// Multiple data types found: String: 4.8%, DateTime (Date): 95.2% out of 21 sampled entries
  submittedDate       DateTime? @db.Date
  wholeProgram        Boolean?
  createdAt           DateTime  @default(now()) @db.Date
  updatedAt           DateTime  @updatedAt @db.Date
  newInstitutions     newInstitution[]
  GPAName             String?
  applicantID         String?
  applicant           User? @relation(fields: [applicantID], references: [id])
  inactiveReminder    Boolean?
  inactiveReminder_7   Boolean?
  inactiveReminder_15  Boolean?
  inactiveReminder_30  Boolean?
  finalInactiveReminder Boolean?
  @@map("applications")
}

model ApprovedStudy {
  id                String   @id @default(uuid()) @map("_id")
  ORCID             String?
  PI                String?
  controlledAccess  Boolean
  dbGaPID           String?
  openAccess        Boolean?
  originalOrg       String?
  primaryContactID  String?
  programName       String?
  programID         String?
  studyAbbreviation String
  studyName         String
  useProgramPC      Boolean?
  pendingModelChange Boolean?
  createdAt         DateTime @default(now()) @db.Date
  updatedAt         DateTime @updatedAt @db.Date
  applicationID String?
  submission Submission[]
  isPendingGPA      Boolean?
  GPAName           String?
  Concierge User? @relation(fields: [primaryContactID], references: [id])
  program Program? @relation(fields: [programID], references: [id])

  @@index([programID], map: "programID_index")
  @@map("approvedStudies")
}

model Batch {
  id            String       @id @default(uuid()) @map("_id")
  bucketName    String
  displayID     Int
  errors        String[]
  fileCount     Int
  filePrefix    String
  files         BatchFiles[]
  status        String
  submissionID  String
  submitterID   String? // do we use this one???
  submitterName String? // do we use this one???
  type          String
  zipFileName   String?
  createdAt     DateTime     @default(now()) @db.Date
  updatedAt     DateTime     @updatedAt @db.Date

  submission Submission @relation(fields: [submissionID], references: [id], onDelete: Cascade)

  @@map("batch")
}

// needs schema standarlization badly!
model Configuration {
  id                               String            @id @default(uuid()) @map("_id")
  COMPLETED_RETENTION_DAYS         Int?
  DASHBOARD_SESSION_TIMEOUT        Int?
  Defaults                         PBACDefaults[]
  EMAIL_URL                        String?
  INACTIVE_APPLICATION_DAYS        Int?
  INACTIVE_SUBMISSION_DAYS_DELETE  Int?
  INACTIVE_USER_DAYS               Int?
  OFFICIAL_EMAIL                   String?
  PRESIGN_EXPIRATION               Int?
  PROD_URL                         String?
  REMIND_APPLICATION_DAYS          Int?
  REVIEW_COMMITTEE_EMAIL           String[]
  ROLE_TIMEOUT                     Int?
  SCHEDULED_JOBS                   String?
  SUBMISSION_BUCKET                String?
  SUBMISSION_HELPDESK              String?
  SUBMISSION_REQUEST_CONTACT_EMAIL String?
  SUBMISSION_SYSTEM_PORTAL         String?
  TECH_SUPPORT_EMAIL               String?
  age                              Int?
  bucketName                       String?
  current                          String?
  current_version                  String?
  dashboardID                      String?
  dataCommons                      String?
  days                             Int?
  interval                         Int?
  key                              String[]
  keys                             Json?
  new                              String?
  prefix                           String?
  tag                              ConfigurationTag?
  timeout                          Int?
  type                             String
  version                          String?
  OMBInfo                          String[]
  OMBNumber                        String?
  expirationDate                   DateTime? @default(now()) @db.Date

  @@map("configuration")
}

model DataRecord {
  id                   String            @id @default(uuid()) @map("_id")
  CRDC_ID              String?
  IDPropName           String
  additionalErrors     AdditionalError[]
  batchIDs             String[]
  dataCommons          String
  entityType           String?
  errors               Error[]
  latestBatchDisplayID Int
  latestBatchID        String
  lineNumber           Int
  nodeID               String
  nodeType             String
  orginalFileName      String
  parents              Parent[]
  props                Json
  qcResultID           String?
  rawData              Json
  s3FileInfo           S3FileInfo?
  status               String
  studyID              String
  submissionID         String
  uploadedDate         DateTime          @db.Date
  validatedAt          DateTime?         @db.Date
  warnings             Error[]
  createdAt            DateTime          @default(now()) @db.Date
  updatedAt            DateTime          @updatedAt @db.Date

  submission Submission @relation(fields: [submissionID], references: [id], onDelete: Cascade)

  @@index([submissionID, nodeType, nodeID], map: "submissionID_nodeType_nodeID")
  @@index([dataCommons, nodeType, nodeID], map: "dataCommons_nodeType_nodeID")
  @@index([submissionID], map: "submissionID_index")
  @@index([studyID, entityType, nodeID], map: "studyID_entityType_nodeID")
  @@map("dataRecords")
}

model DataRecordsArchived {
  id                   String            @id @default(uuid()) @map("_id")
  CRDC_ID              String?
  IDPropName           String
  /// Could not determine type: the field only had null or empty values in the sample set.
  additionalErrors     AdditionalError[]
  batchIDs             String[]
  dataCommons          String
  entityType           String?
  errors               Error[]
  latestBatchDisplayID Int
  latestBatchID        String
  lineNumber           Int
  nodeID               String
  nodeType             String
  orginalFileName      String
  parents              Parent[]
  props                Json
  qcResultID           String?
  rawData              Json
  s3FileInfo           S3FileInfo?
  status               String
  studyID              String?
  submissionID         String
  uploadedDate         DateTime          @db.Date
  validatedAt          DateTime?         @db.Date
  warnings             Error[]
  createdAt            DateTime          @default(now()) @db.Date
  updatedAt            DateTime          @updatedAt @db.Date

  @@map("dataRecordsArchived")
}

model FileMD5 {
  id           String   @id @default(uuid()) @map("_id")
  LastModified DateTime @db.Date
  fileName     String
  md5          String
  submissionID String
  createdAt    DateTime @default(now()) @db.Date
  updatedAt    DateTime @updatedAt @db.Date

  @@map("fileMD5")
}

model PendingPVs {
  id                String    @id @default(uuid()) @map("_id")
  submissionID      String
  offendingProperty String
  value             String
  createdAt         DateTime? @default(now()) @db.Date
  updatedAt         DateTime? @updatedAt @db.Date
  @@map("pendingPvs")
}

model Institution {
  id             String    @id @default(uuid()) @map("_id")
  name           String
  status         String
  submitterCount Int?
  createdAt      DateTime? @default(now()) @db.Date
  updatedAt      DateTime? @updatedAt @db.Date
  @@map("institutions")
}

model Log {
  id            String           @id @default(uuid()) @map("_id")
  action        String?
  applicationID String?
  eventDetail   LogsEventDetail?
  eventType     String
  localtime     DateTime         @db.Date
  newProfile    Json?
  newState      String?
  prevProfile   Json?
  prevState     String?
  submissionID  String?
  timestamp     Float
  userEmail     String
  userID        String
  userIDP       String?
  userName      String?

  @@map("logs")
}

model Program {
  id             String      @id @default(uuid()) @map("_id")
  abbreviation   String?
  bucketName     String?
  conciergeEmail String?
  conciergeID    String?
  conciergeName  String?
  description    String?
  name           String
  rootPath       String?
  status         String
  createdAt      DateTime    @default(now()) @db.Date
  updateAt       DateTime    @updatedAt @db.Date // this is a typo, but it's been like this for a while
  readOnly       Boolean?
  submission Submission[]
  studies ApprovedStudy[]
  Concierge User? @relation(fields: [conciergeID], references: [id])

  @@map("organization")
}

model QcResult {
  id             String   @id @default(uuid()) @map("_id")
  batchIDs       String[]
  dataRecordID   String
  displayID      Int
  errors         Error[]
  latestBatchID  String
  origin         String?
  severity       String
  submissionID   String
  submittedID    String
  type           String
  uploadedDate   DateTime @db.Date
  validatedDate  DateTime @db.Date
  validationType String
  warnings       Error[]

  submission Submission @relation(fields: [submissionID], references: [id], onDelete: Cascade)

  @@index([submissionID], map: "submissionID_1")
  @@map("qcResults")
}

model Release {
  id           String    @id @default(uuid()) @map("_id")
  CRDC_ID      String?
  dataCommons  String
  entityType   String?
  nodeID       String
  nodeType     String
  parents      Parent[]
  props        Json
  status       String
  studyID      String?
  submissionID String
  createdAt    DateTime  @default(now()) @db.Date
  updatedAt    DateTime? @updatedAt @db.Date

  @@index([dataCommons, nodeType, nodeID], map: "dataCommons_nodeType_nodeID")
  @@index([CRDC_ID], map: "CRDC_ID")
  @@map("release")
}

model Submission {
  id                       String         @id @default(uuid()) @map("_id")
  ORCID                    String?
  accessedAt               DateTime?       @db.Date
  archived                 Boolean?
  bucketName               String
  collaborators            Collaborator[]
  controlledAccess         Boolean?
  /// Multiple data types found: String: 92.9%, Boolean: 7.1% out of 375 sampled entries
  crossSubmissionStatus    String?
  dataCommons              String
  dataCommonsDisplayName   String?
  dataFileSize             DataFileSize
  dataType                 String
  dbGaPID                  String?
  deletingData             Boolean?
  fileErrors               FileError[]
  /// Multiple data types found: String: 98.5%, Boolean: 1.5% out of 375 sampled entries
  fileValidationStatus     String?
  /// Could not determine type: the field only had null or empty values in the sample set.
  fileWarnings             FileError[]
  finalInactiveReminder    Boolean?
  history                  History[]
  inactiveReminder_30      Boolean?
  inactiveReminder_60      Boolean?
  inactiveReminder_7       Boolean?
  intention                String
  /// Multiple data types found: String: 99.5%, Boolean: 0.5% out of 375 sampled entries
  metadataValidationStatus String?
  modelVersion             String
  name                     String
  nodeCount                Int?
  /// Could not determine type: the field only had null or empty values in the sample set.
  reviewComment            String?
  rootPath                 String
  status                   String
  studyAbbreviation        String?
  studyName                String?
  studyID                  String
  submitterID              String
  conciergeID              String?
  validationEnded          DateTime?      @db.Date
  validationScope          String?
  validationStarted        DateTime?      @db.Date
  validationType           String[]
  createdAt                DateTime       @default(now()) @db.Date
  updatedAt                DateTime       @updatedAt @db.Date
  programID                String?
  organization             Program? @relation(fields: [programID], references: [id])
  study                    ApprovedStudy? @relation(fields: [studyID], references: [id])
  submitter                User? @relation("submitter", fields: [submitterID], references: [id])
  concierge                User? @relation("concierge", fields: [conciergeID], references: [id])
  batches     Batch[]
  dataRecords DataRecord[]
  qcResults   QcResult[]
  validations Validation[]
  @@map("submissions")
}

type FileError {
    submissionID String?
    dataRecordID String?
    validationType String?
    batchID String?
    batchIDs String[]
    displayID Int?
    type String?
    submittedID String?
    severity String?
    uploadedDate DateTime?
    validatedDate DateTime?
    errors Error[]
    warnings Error[]
}

model Synonym {
  /// Multiple data types found: String: 47.5%, String (ObjectId): 52.5% out of 1000 sampled entries
  id              String @id @default(uuid()) @map("_id")
  equivalent_term String
  synonym_term    String

  @@index([synonym_term], map: "synonym_term_1")
  @@map("synonyms")
}

model User {
  id            String           @id @default(uuid()) @map("_id")
  IDP           String
  /// Multiple data types found: String: 14.6%, DateTime (Date): 85.4% out of 48 sampled entries
  dataCommons   String[]
  email         String
  firstName     String
  institution   InstitutionInfo?
  lastName      String
  fullName      String?
  notifications String[]
  permissions   String[]
  role          String
  status        String? // do we use this???
  studies       StudyByID[]
  tokens        String[]
  userStatus    String
  createdAt     DateTime         @default(now()) @db.Date
  /// Multiple data types found: String: 2.1%, DateTime (Date): 97.9% out of 48 sampled entries
  updateAt      DateTime         @updatedAt @db.Date

  programs        Program[]
  submitters Submission[] @relation("submitter")
  concierges Submission[] @relation("concierge")
  approvedStudies ApprovedStudy[]
  applicants Application[]
  @@map("users")
}

model Validation {
  id           String    @id @default(uuid()) @map("_id")
  ended        DateTime? @db.Date
  scope        String?
  started      DateTime  @db.Date
  status       String?
  submissionID String
  type         String[]

  submission Submission @relation(fields: [submissionID], references: [id], onDelete: Cascade)

  @@map("validation")
}
